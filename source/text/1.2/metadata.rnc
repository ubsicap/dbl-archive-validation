# metadata.rnc
# This is a compact syntax Relax NG Schema for the DBL @type="text" metadata information file.
# DBL bundle version = 1.2

default namespace = ""
datatypes xsd = "http://www.w3.org/2001/XMLSchema-datatypes"

start =
  element DBLMetadata {
    attribute type { "text" }&
    attribute typeVersion {"1.2"}&
    # id is overwritten at submission 
    attribute id { xsd:string { pattern="[a-f0-9]{16}" } }&
    attribute revision { xsd:integer }&
    ##attribute xml:base { "http://purl.org/ubs/metadata/dc/terms/" }&
    element identification {
      element name {
        ##attribute dcds:propertyURI { "title" },
        xsd:string { minLength = "2" }
      }&
      # nameLocal should default to name 
      element nameLocal { xsd:string { minLength = "2" } }&
      element abbreviation { xsd:string { pattern="[A-Za-z0-9\-]{2,8}" } }&
      # abbreviationLocal should default to abbreviation
      element abbreviationLocal { xsd:string { pattern="[A-Za-z0-9\-]{2,8}" } }&
      element scope {
        ##attribute dcds:propertyURI { "title/scriptureScope" },
        text 
      }&
      element description {
        ##attribute dcds:propertyURI { "description" },
        text 
      }&
      element dateCompleted {
        ##attribute dcds:propertyURI { "date" },
        ##attribute dcds:sesURI { "http://purl.org/dc/terms/W3CDTF" },
        (xsd:date | xsd:gYear | xsd:gYearMonth | xsd:dateTime )?
	  }&
      # systemId[@type='paratext'] is overwritten by Paratext
      element systemId {(
        ## UBS Translation Management System database ID
        (attribute type { "tms" })|
        ## Paratext Project GUID
        (attribute type { "paratext" })|
        ## SIL REAP database ID
        (attribute type { "reap" })|
        ## Biblica database id
        (attribute type { "biblica" })
        ),
        xsd:string { minLength = "2" } 
      }*&
      # bundleProducer is overwritten by Paratext
      element bundleProducer { xsd:string { minLength = "2" } }
    }&
    element confidential {
      ##attribute dcds:propertyURI { "accessRights/confidential" },
      xsd:boolean
    }&
    element agencies {
      element etenPartner { "UBS" | "WBT" | "Biblica" }?&
      # primary translation or coordination/sponsorship agency
      element creator { 
        ##attribute dcds:propertyURI { "creator" },
        xsd:string { minLength = "2" } 
      }+&
      # publisher may be the same as translation (description/sponsorship) 
      element publisher {
        ##attribute dcds:propertyURI { "publisher" },
        xsd:string { minLength = "2" } 
      }?&
      element contributor {
        ##attribute dcds:propertyURI { "contributor" },
        text 
      }*
    }&
    element language {
      element iso { 
        ##attribute dcds:propertyURI { "language/iso" },
        ##attribute dcds:sesURI { "http://purl.org/dc/terms/ISO639-3" },
        xsd:string { pattern = "[a-z][a-z][a-z]" }
      }&
      element name { 
        ##attribute dcds:propertyURI { "subject/subjectLanguage" },
        ##attribute dcds:sesURI { "http://purl.org/dc/terms/ISO639-3" }, 
        xsd:string { minLength = "2" }
      }&
      element ldml { 
        ##attribute dcds:propertyURI { "language/ldml" },
        xsd:string { pattern = "[a-z]{2}(\-[A-Za-z]+){0,3}" }?
      }&
      element rod { 
        ##attribute dcds:propertyURI { "language/rod" }, 
        xsd:string { pattern = "[0-9]{5}" }?
      }&
      element script {
        ##attribute dcds:propertyURI { "language/script" },
        xsd:string { minLength = "2" }
      }&
      # LTR (Left to Right) or RTL (Right to Left) 
      # scriptDirection is overwritten by Paratext
      element scriptDirection {
        ##attribute dcds:propertyURI { "language/scriptDirection" },
        ("LTR" | "RTL") 
      }&
      element numerals {
        ##attribute dcds:propertyURI { "language/numerals" },
        ( empty | numeralSystem )
      }
    }&
    element country { 
      element iso { 
        ##attribute dcds:propertyURI { "coverage/spatial" },
        ##attribute dcds:sesURI { "http://purl.org/dc/terms/ISO3166" }, 
        xsd:string { pattern = "[A-Z][A-Z][A-Z]?" } 
      }&
      element name { 
        ##attribute dcds:propertyURI { "subject/subjectCountry" }, 
        xsd:string { minLength = "2" } 
      }
    }&
    element type { 
      element translationType { 
        ##attribute dcds:propertyURI { "type/translationType" }, 
        translationType ?
      }& 
      element audience {
        ##attribute dcds:propertyURI { "audience" }, 
        translationLevel ?
      }
    }&
    # bookNames/book is overwritten by Paratext
    element bookNames { 
      element book { 
        attribute code { bookCode }& 
        element long { 
          text 
        }& 
        element short { 
          text 
        }& 
        element abbr { 
          text 
        }
#        element name { 
#          attribute type {"long"}, 
#          text 
#        }& 
#        element name { 
#          attribute type {"short"}, 
#          text 
#        }& 
#        element name { 
#          attribute type {"abbr"}, 
#          text 
#        }
      }*
    }&
    element contents {
      ##attribute dcds:propertyURI { "tableOfContents" },
      element bookList {
        attribute id { "default" }?&
        # default to name from identification section  
        element name { text }&
        # default to name local from identification section 
        element nameLocal { text }& 
        element abbreviation { text }& 
        element abbreviationLocal { text }&
        # e.g. "NT" | "NT + OT" or <Name> from Cannons.xml
        element description { text }&
        # e.g Protestant Bible (66 books) 
        element range { text }&
        # e.g Western Protestant order 
        element tradition { text }&
        element division {
          attribute id { "OT" | "NT" | "DC" },
          element books { 
            element book { 
              attribute code { bookCode }
            }+
          }
        }+
      }+
    }&
    # progress is overwritten by Paratext
    element progress {
      ##attribute dcds:propertyURI { "description/stage" },
      element book {
        attribute code { bookCode }&
        attribute stage { translationStage }
      }*
    }?&
	# Default to Publisher (from agencies) 
    element contact {
      element rightsHolder {
        ##attribute dcds:propertyURI { "rightsHolder" },
        xsd:string { minLength = "2" }
      }&
	  # Default to rights holder 
      element rightsHolderLocal {
        ##attribute dcds:propertyURI { "rightsHolder/contactLocal" },
        xsd:string { minLength = "2" }?
      }&
      element rightsHolderAbbreviation {
        ##attribute dcds:propertyURI { "rightsHolder/contactAbbreviation" },
        xsd:string { minLength = "2" }?
      }&
      element rightsHolderURL {
        ##attribute dcds:propertyURI { "rightsHolder/contactURL" },
        xsd:anyURI?
      }&
      element rightsHolderFacebook {
        ##attribute dcds:propertyURI { "rightsHolder/contactFacebook" },
        xsd:anyURI?
      }
    }&
    element copyright {
      # For example: ©2002, 2012 United Bible Societies
      element statement {
        attribute contentType { "xhtml" },
        ##attribute dcds:propertyURI { "rights" },
        htmlMarkup
      }
    }&
    element promotion {
      element promoVersionInfo {
        attribute contentType { "xhtml" },
        ##attribute dcds:propertyURI { "description/pubPromoVersionInfo" },
		htmlMarkup
      }&
      element promoEmail {
        attribute contentType { "xhtml" },
        ##attribute dcds:propertyURI { "description/pubPromoEmail" },
        htmlMarkup
      }
    }?&
    element archiveStatus {
      # archivistName is overwritten by Paratext
      element archivistName {
        ##attribute dcds:propertyURI { "contributor/archivist" },
        xsd:string { minLength = "2" }
      }&
      # dateArchived is overwritten by Paratext
      element dateArchived {
        ##attribute dcds:propertyURI { "dateSubmitted" },
        ##attribute dcds:sesURI { "http://purl.org/dc/terms/W3CDTF" },
        xsd:dateTime
      }&
      # dateUpdated is overwritten by Paratext
      element dateUpdated {
        ##attribute dcds:propertyURI { "modified" },
        ##attribute dcds:sesURI { "http://purl.org/dc/terms/W3CDTF" },
        xsd:dateTime
      }&
      element comments {
        ##attribute dcds:propertyURI { "abstract" },
        xsd:string { minLength = "2" maxLength = "255" }
      }
    }&
    # format is overwritten by Paratext
    element format {
      ##attribute dcds:propertyURI { "format" },
      ##attribute dcds:sesURI { "http://purl.org/dc/terms/IMT" },
      "text/xml"
    }
  }

htmlMarkup = (
           element p { (text | htmlCharMarkup)+ }
         | element h1 { text }
         | element h2 { text }
         | element h3 { text }
         | element ul { 
             element li { text }+}
         | element ol { 
             element li { text }+}
         | element blockquote { text }
         | htmlCharMarkup)+

htmlCharMarkup = ( text
		 | element a {
             attribute href { xsd:anyURI },
             htmlCharMarkup
           }
         | element img {
            attribute src { xsd:anyURI },
            attribute alt { text }?,
            text
            }           
         | element br { empty }
         | element strong { text }
         | element b { text }
         | element em { text }
         | element i { text })

numeralSystem = (
           "Arabic" # (a.k.a. 'Hindu') = 0123456789
         | "Bengali"
         | "Burmese"
         | "Devanagari"
         | "Ethiopic"
         | "Farsi"
         | "Gujarati"
         | "Gurmukhi"
         | "Hindi" # (i.e. 'Arabic' as used in Egypt)
         | "Kannada"
         | "Khmer"
         | "Malayalam"
         | "Oriya"
         | "Tamil"
         | "Telugu"
         | "Thai"
         | "Tibetan")

translationType = (
           "First"
         | "New"
         | "Revision")

translationLevel = (
           "Basic"
         | "Common"
         | "Common - Literary"
         | "Literary"
         | "Liturgical")

# 1 = draft, 2 = internalReview, 3 = extenalReview, 4 = finalReview
translationStage = ( "1" | "2" | "3" | "4")

bookCode = (
           "GEN"   # Genesis
         | "EXO" # Exodus
         | "LEV" # Leviticus
         | "NUM" # Numbers
         | "DEU" # Deuteronomy   
         | "JOS" # Joshua 
         | "JDG" # Judges 
         | "RUT" # Ruth 
         | "1SA" # 1 Samuel 
         | "2SA" # 2 Samuel 
         | "1KI" # 1 Kings 
         | "2KI" # 2 Kings 
         | "1CH" # 1 Chronicles 
         | "2CH" # 2 Chronicles 
         | "EZR" # Ezra 
         | "NEH" # Nehemiah 
         | "EST" # Esther (Hebrew)
         | "JOB" # Job 
         | "PSA" # Psalms 
         | "PRO" # Proverbs 
         | "ECC" # Ecclesiastes 
         | "SNG" # Song of Songs 
         | "ISA" # Isaiah 
         | "JER" # Jeremiah 
         | "LAM" # Lamentations 
         | "EZK" # Ezekiel 
         | "DAN" # Daniel (Hebrew)
         | "HOS" # Hosea 
         | "JOL" # Joel 
         | "AMO" # Amos 
         | "OBA" # Obadiah 
         | "JON" # Jonah 
         | "MIC" # Micah 
         | "NAM" # Nahum 
         | "HAB" # Habakkuk 
         | "ZEP" # Zephaniah 
         | "HAG" # Haggai 
         | "ZEC" # Zechariah 
         | "MAL" # Malachi 
         | "MAT" # Matthew 
         | "MRK" # Mark 
         | "LUK" # Luke 
         | "JHN" # John 
         | "ACT" # Acts 
         | "ROM" # Romans 
         | "1CO" # 1 Corinthians 
         | "2CO" # 2 Corinthians 
         | "GAL" # Galatians 
         | "EPH" # Ephesians 
         | "PHP" # Philippians 
         | "COL" # Colossians 
         | "1TH" # 1 Thessalonians 
         | "2TH" # 2 Thessalonians 
         | "1TI" # 1 Timothy 
         | "2TI" # 2 Timothy 
         | "TIT" # Titus 
         | "PHM" # Philemon 
         | "HEB" # Hebrews 
         | "JAS" # James 
         | "1PE" # 1 Peter 
         | "2PE" # 2 Peter 
         | "1JN" # 1 John 
         | "2JN" # 2 John 
         | "3JN" # 3 John 
         | "JUD" # Jude 
         | "REV" # Revelation 
         | "TOB" # Tobit 
         | "JDT" # Judith 
         | "ESG" # Esther Greek 
         | "WIS" # Wisdom of Solomon 
         | "SIR" # Sirach (Ecclesiasticus)
         | "BAR" # Baruch 
         | "LJE" # Letter of Jeremiah 
         | "S3Y" # Song of 3 Young Men 
         | "SUS" # Susanna 
         | "BEL" # Bel and the Dragon 
         | "1MA" # 1 Maccabees 
         | "2MA" # 2 Maccabees 
         | "3MA" # 3 Maccabees 
         | "4MA" # 4 Maccabees 
         | "1ES" # 1 Esdras (Greek)
         | "2ES" # 2 Esdras (Latin)
         | "MAN" # Prayer of Manasseh 
         | "PS2" # Psalm 151
         | "ODA" # Odes 
         | "PSS" # Psalms of Solomon 
         | "EZA" # Apocalypse of Ezra 
         | "5EZ" # 5 Ezra 
         | "6EZ" # 6 Ezra 
         | "DAG" # Daniel Greek 
         | "PS3" # Psalms 152-155
         | "2BA" # 2 Baruch (Apocalypse)
         | "LBA" # Letter of Baruch 
         | "JUB" # Jubilees 
         | "ENO" # Enoch 
         | "1MQ" # 1 Meqabyan 
         | "2MQ" # 2 Meqabyan 
         | "3MQ" # 3 Meqabyan 
         | "REP" # Reproof 
         | "4BA" # 4 Baruch 
         | "LAO" # Laodiceans 
           # Non scripture text Id's
         | "XXA" # Extra A, e.g. a hymnal 
         | "XXB" # Extra B 
         | "XXC" # Extra C 
         | "XXD" # Extra D 
         | "XXE" # Extra E 
         | "XXF" # Extra F 
         | "XXG" # Extra G 
         | "FRT" # Front Matter 
         | "BAK" # Back Matter 
         | "OTH" # Other Matter 
         | "INT" # Introduction 
         | "CNC" # Concordance 
         | "GLO" # Glossary 
         | "TDX" # Topical Index 
         | "NDX") # Names Index 
